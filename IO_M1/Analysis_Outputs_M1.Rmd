---
title: "Exploratory Analysis of Model Outputs"
author: "Yimeng Yin"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 4
---


```{r mainSet options, echo=FALSE, cache=FALSE}

# options(width=140)
# knitr::opts_chunk$set(fig.width=16, fig.height=5, echo=FALSE)
# # Note: when saving maps (ggsave), width=16, height=9 seems to get rid of white space

```




```{r Preamble, echo = FALSE, include  = FALSE}
library(reshape2)
library(plyr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(magrittr) # to use %<>%

rm(list = ls())

run_knitr <- T

if(run_knitr) source("../Functions.R") else source("Functions.R")


```


```{r Read, echo=FALSE, include = FALSE}
## Combine selected files into a single list.

if(run_knitr) folder_run <- "../IO_M1" else folder_run <- "IO_M1"

file_select <- dir(folder_run, pattern = ".RData")

fn <- function(x) {
       load(paste0(folder_run, "/", x))
       outputs_list
  }

lists_all        <- alply(file_select, 1, fn)
names(lists_all) <- laply(lists_all, function(x) x$paramlist$runname)

## Combine the results into a single data frame.
results_all <- ldply(lists_all, function(x) x$results) %>% select(-X1)


```



# 100% Initial Funding

- M1-F100-1	100% initial Funding; No Smoothing 
- M1-F100-2	100% initial Funding; Closed 10-year cd
- M1-F100-3	100% initial Funding; Closed 30-year cd
- M1-F100-4	100% initial Funding; Closed 30-year cp
- M1-F100-5	100% initial Funding; Open 30-year cp
- M1-F100-6	100% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing
	
	
	
```{r F100_FR, echo = FALSE, cache = F , eval = TRUE, fig.width=20, fig.height=4}

prefix <- "M1-F100-"

draw_quantiles(paste0(prefix, 1:6), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, 1:6), "ERC_PR", ylim = c(-2, 35)) %>% print

```


- M1-F100-6	100% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing
- M1-F100-7	100% initial Funding; Full smoothing, DR 5.5%, ir 7.5%, sd 12%
- M1-F100-8	100% initial Funding; Full smoothing, DR 5.5%, ir 5.5%, sd 8%

```{r F100_ERC, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

draw_quantiles(paste0(prefix, 6:8), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, 6:8), "ERC_PR", ylim = c(-2, 35)) %>% print


# draw_quantiles(paste0(prefix, 1:6), "C_PR", ylim = c(-2, 35)) %>% print
# draw_quantiles(paste0(prefix, 6:8), "C_PR", ylim = c(-2, 35)) %>% print
# draw_quantiles(paste0(prefix, 1:3), "B_PR") %>% print
```


# 75% Initial Funding
- M1-F75-1	75% initial Funding; No Smoothing 
- M1-F75-2	75% initial Funding; Closed 10-year cd
- M1-F75-3	75% initial Funding; Closed 30-year cd
- M1-F75-4	75% initial Funding; Closed 30-year cp
- M1-F75-5	75% initial Funding; Open 30-year cp
- M1-F75-6	75% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing

	
	
```{r F75_FR, echo = FALSE, cache = F , eval = TRUE, fig.width=20, fig.height=4}

prefix <- "M1-F75-"

draw_quantiles(paste0(prefix, 1:6), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, 1:6), "ERC_PR", ylim = c(-2, 35)) %>% print

```

- M1-F75-6	75% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing
- M1-F75-7	75% initial Funding; Full smoothing, DR 5.5%, ir 7.5%, sd 12%
- M1-F75-8	75% initial Funding; Full smoothing, DR 5.5%, ir 5.5%, sd 8%

```{r F75_ERC, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

draw_quantiles(paste0(prefix, 6:8), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, 6:8), "ERC_PR", ylim = c(-2, 35)) %>% print


# draw_quantiles(paste0(prefix, 1:6), "C_PR", ylim = c(-2, 35)) %>% print
# draw_quantiles(paste0(prefix, 6:8), "C_PR", ylim = c(-2, 35)) %>% print
# draw_quantiles(paste0(prefix, 1:3), "B_PR") %>% print
```



# BRP 100% Initial Funding 

- M1-F100-6	100% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing
- M1-F100-BRP1	100% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 7.5%, ir 7.5%, sd 12%
- M1-F100-BRP2	100% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 6.4%, ir 7.5%, sd 12%
- M1-F100-BRP3	100% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing, ir 6.4%, sd 8%
- M1-F100-BRP4	100% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 7.5%, ir 6.4%, sd 8%
- M1-F100-BRP5	100% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 6.4%, ir 6.4%, sd 8%


Under stochastic return: mean = 7.5%, SD = 12%
- F100-6: full smoothing; 7.5% discount
- BRP1  : 15-year cp;     discount rate 7.5%, 
- BRP2  : 15-year cp;     discount rate 6.4%. 

```{r BRP100_1, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

prefix <- "M1-F100-"

draw_quantiles(paste0(prefix, c("6", "BRP1", "BRP2")), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, c("6", "BRP1", "BRP2")), "ERC_PR", ylim = c(-2, 35)) %>% print



```


Under stochastic return: mean = 6.4%, SD = 8%

- BRP3  : Full smoothing; discount rate 7.5%, 
- BRP4  : 15-year cp;     discount rate 7.5%, 
- BRP5  : 15-year cp;     discount rate 6.4%. 


```{r BRP100_2, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

prefix <- "M1-F100-"

draw_quantiles(paste0(prefix, c("BRP2", "BRP4")), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, c("BRP2", "BRP4")), "ERC_PR", ylim = c(-2, 35)) %>% print

```


# BRP 75% Initial Funding 

- M1-F75-6	75% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing
- M1-F75-BRP1	75% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 7.5%, ir 7.5%, sd 12%
- M1-F75-BRP2	75% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 6.4%, ir 7.5%, sd 12%
- M1-F75-BRP3	75% initial Funding; Full smoothing:open 30 year cp; 5-year asset smoothing, ir 6.4%, sd 8%
- M1-F75-BRP4	75% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 7.5%, ir 6.4%, sd 8%
- M1-F75-BRP5	75% initial Funding; BRP: open 15-year cp; 5-year asset smoothing, DR 6.4%, ir 6.4%, sd 8%


Under stochastic return: mean = 7.5%, SD = 12%

- F100-6: full smoothing; 7.5% discount
- BRP1  : 15-year cp;     discount rate 7.5%, 
- BRP2  : 15-year cp;     discount rate 6.4%

```{r BRP75_1, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

prefix <- "M1-F75-"

draw_quantiles(paste0(prefix, c("6", "BRP1", "BRP2")), "FR",     ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix, c("6", "BRP1", "BRP2")), "ERC_PR", ylim = c(-2, 35)) %>% print

```


Under stochastic return: mean = 6.4%, SD = 8%

- BRP3  : Full smoothing; discount rate 7.5%, 
- BRP4  : 15-year cp;     discount rate 7.5%, 
- BRP5  : 15-year cp;     discount rate 6.4%. 


```{r BRP75_2, echo = FALSE, cache = F , eval = TRUE, fig.width=14, fig.height=5}

prefix <- "M1-F75-"

draw_quantiles(paste0(prefix,  c("BRP3", "BRP4", "BRP5")), "FR", ylim = c(0, 250)) %>% print
draw_quantiles(paste0(prefix,  c("BRP3", "BRP4", "BRP5")), "ERC_PR", ylim = c(-2, 35)) %>% print

```


